<!DOCTYPE html>
<html>
<head>
	<title>商品损耗</title>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="css/easyui.css">
	<link rel="stylesheet" type="text/css" href="css/icon.css">
	<link rel="stylesheet" type="text/css" href="css/app.css">
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="js/easyui-lang-zh_CN.js"></script>
</head>
<body>
	<div class="easyui-panel" id="view_position">
			<form id="commodity_destroy" method="post" action="controller/commodity_destroy.php">
			<div style="margin-bottom:20px">
				<span>商品名称：</span>
				<input class="easyui-combobox" name="cid" data-options="
				prompt:'输入商品名称...',
				url:'model/combobox.php',
				method:'get',
				valueField:'cid',
				textField:'text',
				onSelect: function(rec){
					loadInfo(rec.text);
				}
				" style="width:200px">
			</div>
			<div style="margin-bottom:20px">
				<div class="easyui-panel" title="商品标签" style="width:260px;height:200px;padding:10px">
					<div class="commodity_info">类别：<span id="show_type"></span></div>
					<div class="commodity_info">库存：<span id="show_num"></span></div>
					<div class="commodity_info">进价：<span id="show_cost"></span></div>
					<div class="commodity_info">定价：<span id="show_price"></span></div>
				</div>
			</div>
			<div style="margin-bottom:20px">
				<span>损耗数目：</span>
				<input class="easyui-numberbox" name="dnum" required="true" style="width:60px">
				<span id="show_smallunit" style="margin-left:10px"></span>
			</div>
			<div>
				<span>备注：</span>
				<input class="easyui-textbox" name="statement" data-options="prompt:'输入备注信息...'" multiline="true" value="" style="width:260px;height:120px">
			</div>
			</form>
			<div style="margin-bottom:20px">
			<a href="javascript:void(0)" class="easyui-linkbutton" onclick="submitForm()" style="width:80px">确认</a>
			<a href="javascript:void(0)" class="easyui-linkbutton" onclick="clearForm()" style="width:80px;margin-left:20px">清空</a>
			</div>
	</div>
	<script>
		function loadInfo(name) {
			$.ajax({
				type:"post",
				url:"model/load_commodity_info.php",
				data: {'cname':name},
				success:function(res){
					var obj = eval('(' + res + ')');
					$('#show_type').html(obj[0].tname);
					$('#show_num').html(obj[0].cnum + " " +obj[0].small_unit);
					$('#show_cost').html(obj[0].ccost);
					$('#show_price').html(obj[0].csticker_price);
					$('#show_smallunit').html(obj[0].small_unit);
				}
			});
		}
		function clearPanel(){
			$('#show_type').html("");
			$('#show_num').html("");
			$('#show_cost').html("");
			$('#show_price').html("");
			$('#show_smallunit').html("");
		}
		function submitForm(){
			// 完善时候，添加检测各输入框是否为空
			$('#commodity_destroy').form('submit',{
				// onSubmit: function(){
				// 	return $(this).form('validate'); //完善
				// },
				success:function(data){
					if (data == 1) {
						alert("损耗信息已记录！");
						$('#commodity_destroy').form('clear');
						clearPanel();
					} else {
						alert("记录失败!");
					} 
				}
			});
			
		}
		function clearForm(){
			$('#stock_input').form('clear');
			clearPanel();
		}


	</script>

</body>
</html>