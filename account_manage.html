<!DOCTYPE html>
<html>
<head>
	<title>账目管理</title>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="css/easyui.css">
	<link rel="stylesheet" type="text/css" href="css/icon.css">
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="js/easyui-lang-zh_CN.js"></script>
</head>
<body>
	<div class="easyui-panel" id="view_position_2">
		
		<div id="account_manage">
		<div style="margin-bottom:10px;margin-left:200px">
			<span>商品名称：</span>
			<span><input class="easyui-searchbox" data-options="prompt:'请输入商品名称...',searcher:doSearch" style="width:250px"></span>	
		</div>
		<table id="data_grid" title="所有商品" class="easyui-datagrid" style="width:900px;height:380px"
		data-options="
		url:'model/get_accounts_datagrid.php',
		method:'post',
		toolbar:'#toolbar',
		fitColumns:true,
		rownumbers:true	,
		singleSelect:true,
		striped:true,
		pagination:true
		">
		<thead>
			<tr>
				<th field="aid" width="80" hidden=true>隐藏</th>
				<th field="aitem"  width="80">账目记录</th>
				<th field="aitem_money" width="50">记录金额</th>
				<th data-options="field:'isrepay',width:'50', formatter:format">是否归还</th>
				<th field="atime"  width="60">记录时间</th>
			</tr>
		</thead>
		</table>
		<div id="toolbar">
			<a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="popDlg()">增加</a>
			<a href="#" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="popDlg()">修改</a>
			<a href="#" class="easyui-linkbutton" iconCls="icon-no" plain="true" onclick="deleteCommodity()">删除</a>
		</div>
		</div> <!-- account_manage div end -->
		<!-- 对话框 -->
		<div id="dlg" class="easyui-dialog" style="width:400px;height:298px;padding:10px 20px"
		closed="true" buttons="#dlg-buttons">
		<form id="update_commodity" method="post" action="">
			<div class="dlg_body">
				<div>		
					<span><font>名称：</font></span>
					<span><input class="easyui-textbox" name="cname" data-options="" style="width:150px"></span>
				</div>
				<div>		
					<span>类别：</span>
					<span><input class="easyui-textbox" name="tname" data-options="disabled:true" style="width:150px"></span>
				</div>
				<div>
					<span>规格：</span>
					<span><input class="easyui-numberbox" name="cunit_value" data-options="precision:0,width:'150px'"></span>
				</div>
				<div>
					<span>进价：</span>
					<span><input class="easyui-numberbox" name="ccost" data-options="precision:2,groupSeparator:',',width:'150px'"></span>
				</div>
				<div>
					<span>定价：</span>
					<span><input class="easyui-numberbox" name="csticker_price" data-options="precision:1,groupSeparator:',',width:'150px'"></span>
				</div>
				<div>
					<span>库存：</span>
					<span><input class="easyui-numberbox" name="cnum" data-options="precision:0,width:'150px',disabled:true"></span>
				</div>
			</div>
		</form>
		</div> <!--  对话框结束-->
		<div id="dlg-buttons">
			<a href="#" class="easyui-linkbutton" iconCls="icon-ok" onclick="updateCommodity()">修改</a>
			<a href="#" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')">取消</a>
		</div>
	</div>
	<script>
		$(function(){
			$('#data_grid').datagrid('clientPaging');
		});
		function format(val,row,index){
			if (row.isrepay == "0") 
				return "<span style='color:red'>未归还×</span>";
			else
				return "<span style='color:green'>已归还√</span>";
		}
		var url;
		function popDlg(){	
			var row = $('#data_grid').datagrid('getSelected');
			if (row){
				$('#dlg').dialog('open').dialog('setTitle','修改商品信息');
				$('#update_commodity').form('load',row);
				url = 'controller/update_commodity.php?oldcname='+row.cname;
			}
		}
		function updateCommodity(){
			$('#update_commodity').form('submit',{
				url: url,
				onSubmit: function(){
					return $(this).form('validate');
				},
				success: function(result){
					if (result == 1){
						$('#dlg').dialog('close');
						$('#data_grid').datagrid('reload');	
						alert("修改成功");
					} else {
						alert("修改失败");
					}
				}
			});
		}
		function deleteCommodity(){
			var row = $('#data_grid').datagrid('getSelected');
			if (row){
				$.messager.confirm('确认','确定删除该商品信息吗?',function(r){
					if (r){
						$.post('controller/delete_commodity.php',{cname:row.cname},function(result){
							if (result == 1){
								$('#data_grid').datagrid('reload');	// reload the user data
								alert("商品已删除");
							} else {
								alert("修改失败");
							}
						},'json');
					}
				});
			}
		}
		function doSearch(value){
			$('#data_grid').datagrid('load',{
				cname: value
			});
		}
	</script>
</body>
</html>